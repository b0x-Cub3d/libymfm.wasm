{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-ea87b3687ea5defc.js","src/js/wgm_main_thread.js","node_modules/@parcel/runtime-js/lib/runtime-a6608c675ad717b2.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","src/js/main.js","node_modules/@parcel/runtime-js/lib/runtime-582144933f8338b5.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"iUJgi\\\":\\\"index.fa78ce22.js\\\",\\\"cHc5m\\\":\\\"wgm_worklet_processor.ed3f5c00.js\\\",\\\"bktC1\\\":\\\"libymfm_bg.b990d7a9.wasm\\\"}\"));","// license:BSD-3-Clause\n// copyright-holders:Hiromasa Tanaka\nimport worklet from 'worklet:./wgm_worklet_processor.js'; // worklet: Parcel\n\nconst AUDIO_WORKLET_SAMPLING_CHUNK = 128;\n\n/**\n * AudioWorklet Controller\n */\nexport class WgmController {\n    /**\n     * Constructor\n     *\n     * @param {*} module WebAssembly module binary\n     * @param {*} samplingRate Sampling rate\n     * @param {*} loopMaxCount Max loop count\n     * @param {*} feedOutSecond Music feed out second\n     */\n    constructor(module, samplingRate, loopMaxCount, feedOutSecond) {\n        // WebAssembly binary\n        this.module = module;\n        // sampling rate\n        this.samplingRate = samplingRate;\n        this.loopMaxCount = loopMaxCount;\n        this.feedOutSecond = feedOutSecond;\n        this.feedOutRemain = Math.floor((samplingRate * feedOutSecond) / AUDIO_WORKLET_SAMPLING_CHUNK);\n        // init audio contexts\n        this.context = null;\n        this.worklet = null;\n        this.gain = null;\n        this.analyser = null;\n        this.analyserBuffer = null;\n        this.analyserBufferLength = null;\n    }\n\n    /**\n     * prepare AudioContext and AudioWorklet\n     *\n     * Create Worklet and compile Webassembly in Worklet\n     *\n     * @param {*} context AudioContext\n     */\n    async prepare(context) {\n        // set audio context\n        this.context = context;\n        // create and compile Wasm AudioWorklet\n        await this.context.audioWorklet.addModule(worklet);\n    }\n\n    /**\n     * Initialize Controller\n     *\n     * Initialize AudioNode Worklet and analyser\n     */\n    init(callback) {\n        this.worklet = new AudioWorkletNode(this.context, \"wgm-worklet-processor\", {\n            \"numberOfInputs\": 1,\n            \"numberOfOutputs\": 1,\n            \"outputChannelCount\": [2], // 2ch stereo\n            \"processorOptions\": {\n                \"module\": this.module,\n                \"samplingRate\": this.samplingRate,\n                \"chunkSize\": AUDIO_WORKLET_SAMPLING_CHUNK,\n                \"loopMaxCount\": this.loopMaxCount,\n                \"feedOutRemain\": this.feedOutRemain,\n            }\n        });\n        // message dispatch\n        this.callback = null;\n        this.worklet.port.onmessage = (event) => this.dispatch(event);\n        // wasm compile\n        this.send({ \"message\": \"compile\" }, () => {\n            // connect gain\n            this.gain = this.context.createGain();\n            this.gain.connect(this.context.destination);\n            // connect node\n            this.worklet.connect(this.gain);\n            // connect fft\n            this.analyser = this.context.createAnalyser();\n            this.analyserBufferLength = this.analyser.frequencyBinCount;\n            this.analyserBuffer = new Uint8Array(this.analyserBufferLength);\n            this.analyser.getByteTimeDomainData(this.analyserBuffer);\n            this.gain.connect(this.analyser);\n            // call main\n            callback();\n        });\n    }\n\n    /**\n     * Instance ready?\n     *\n     * @returns {boolean}\n     */\n    ready() {\n        if(this.worklet == null) {\n            return false;\n        }\n        return true;\n    }\n\n    /**\n     * Create playable instance\n     *\n     * @param {*} vgmdata\n     * @param {*} callback(gd3meta)\n     */\n    create(vgmdata, callback) {\n        this.send({\"message\": \"create\", \"vgmdata\": vgmdata}, callback);\n    }\n\n    /**\n     * Start music play\n     *\n     * @param {*} callback end music callback\n     */\n    play(callback) {\n        this.send({\"message\": \"play\"}, callback);\n    }\n\n    /**\n     * Get FFT data current time\n     *\n     * @returns FFT array buffer\n     */\n    getByteFrequencyData() {\n        this.analyser.getByteFrequencyData(this.analyserBuffer);\n        return this.analyserBuffer;\n    }\n\n    /**\n     * Get FFT data length\n     *\n     * @returns FFT array length\n     */\n    getAnalyserBufferLength() {\n        return this.analyserBufferLength;\n    }\n\n    /**\n     * Feed out music\n     */\n    feedout() {\n        const now = this.context.currentTime;\n        // feed out to 0.0\n        this.gain.gain.setValueAtTime(1, now);\n        this.gain.gain.linearRampToValueAtTime(0, now + this.feedOutSecond);\n        // return to 1.0\n        this.gain.gain.setValueAtTime(1, now + this.feedOutSecond);\n    }\n\n    /**\n     * Message dispatcher\n     *\n     * @param {*} event\n     */\n    async dispatch(event) {\n        switch(event.data.message) {\n            case \"callback\": {\n                if(this.callback != null) {\n                    await this.callback(event.data.data);\n                }\n                break;\n            }\n            case \"feedout\": {\n                this.feedout();\n                break;\n            }\n        }\n    }\n\n    /**\n     * Send message to Worklet\n     *\n     * @param {*} message\n     * @param {function} callback\n     */\n    send(message, callback) {\n        // wait for a reply from the worklet\n        if(callback != null) {\n            this.callback = callback;\n        } else {\n            this.callback = null;\n        }\n        // sends a message to the Worklet\n        this.worklet.port.postMessage(message);\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('iUJgi') + require('./helpers/bundle-manifest').resolve(\"cHc5m\");","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","// license:BSD-3-Clause\n// copyright-holders:Hiromasa Tanaka\nimport { WgmController } from \"./wgm_main_thread\";\n\n/**\n * AudioWorklet Player\n */\nlet player;\n\n/**\n * Audio context\n */\nlet audioContext = null;\n\n/**\n * VGM setting\n */\nconst DEFAULT_SAMPLING_RATE = 44100;\nconst LOOP_MAX_COUNT = 2;\nconst FEED_OUT_SECOND = 2;\n\n/**\n * Canvas settings\n */\nconst CANVAS_WIDTH = 768;\nconst CANVAS_HEIGHT = 576;\nconst COLOR_MD_GREEN = '#00a040';\nconst COLOR_MD_RED = '#e60012';\nconst FONT_MAIN_STYLE = '16px sans-serif';\n\n/**\n * VGM member\n */\nlet playlist = [];\nlet totalPlaylistCount;\nlet musicMeta;\nlet samplingRate = DEFAULT_SAMPLING_RATE;\n\n/**\n * Canvas member\n */\nlet canvas;\nlet canvasContext;\nlet animId = null;\n\n/**\n * Canvas setting\n */\n(function() {\n    canvas = document.getElementById('screen');\n    canvas.setAttribute('width', CANVAS_WIDTH);\n    canvas.setAttribute('height', CANVAS_HEIGHT);\n    let pixelRatio = window.devicePixelRatio ? window.devicePixelRatio : 1;\n    if(pixelRatio > 1 && window.screen.width < CANVAS_WIDTH) {\n        canvas.style.width = 320 + \"px\";\n        canvas.style.heigth = 240 + \"px\";\n    }\n    canvasContext = canvas.getContext('2d');\n})();\n\n/**\n * Initialize system\n */\n(async function() {\n    /**\n     * Switch sampling rate for test (ex. https://.../#s=48000)\n     *\n     *  let context = new AudioContext({ sampleRate: samplingRate })\n     *\n     * (2021/9)\n     * Support Firefox only. (I haven't confirmed anything other than Linux platform)\n     * In other browsers, the setting works, but the native connection to the audio interface drops to 44100Hz.\n     * There is probably some downsampling going on inside the browser.\n     * Also, the setting itself may be invalid in Safari.\n     */\n    if(location.hash != \"\") {\n        const sample = location.hash.match(/^#s=(\\d+)/);\n        if(sample != null) {\n            samplingRate = parseInt(sample[1]);\n            if(samplingRate != samplingRate /* isNan */\n                || !(samplingRate == 44100 || samplingRate == 48000 || samplingRate == 88200 || samplingRate == 96000)) {\n                samplingRate = DEFAULT_SAMPLING_RATE;\n            }\n        }\n    }\n\n    /**\n     * Pre-fetch WebAssemby binary module\n     */\n    let module = await fetch(new URL('../wasm/libymfm_bg.wasm', import.meta.url));\n    module = new Uint8Array(await module.arrayBuffer())\n    player = new WgmController(module, samplingRate, LOOP_MAX_COUNT, FEED_OUT_SECOND);\n\n    /**\n     * Create AudioContext and load WebAssembly module\n     */\n    audioContext = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: samplingRate });\n    await player.prepare(audioContext);\n\n    /**\n     * Start event loop\n     */\n     start();\n})();\n\n/**\n * Start event loop\n */\nconst start = () => {\n    canvasContext.fillStyle = 'rgb(0, 0, 0)';\n    canvasContext.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);\n    canvasContext.font = 'bold 28px sans-serif';\n    canvasContext.fillStyle = COLOR_MD_RED;\n    fillTextCenterd(\"WebAssembly 🎮 VGM Player\", CANVAS_HEIGHT / 2 - 32 * 4);\n    canvasContext.fillStyle = COLOR_MD_GREEN;\n    canvasContext.font = '15px sans-serif';\n    fillTextCenterd(\"YM2151 | YM2203 | YM2149 | YM2413 | YM2612 | SN76489(MD) | PWM(32x) | SEGAPCM\", CANVAS_HEIGHT / 2 - 32 * 2);\n    canvasContext.font = '20px sans-serif';\n    fillTextCenterd(\"🎵 DRAG AND DROP VGM(vgm/vgz) HEAR\", CANVAS_HEIGHT / 2 - 32 * 1);\n    fillTextCenterd(\"OR CLICK(TAP) TO PLAY SAMPLE VGM\", CANVAS_HEIGHT / 2 + 32 * 1);\n    printStatus();\n    // Set UI event\n    canvas.addEventListener('dragover', function(e) {\n        prevent(e);\n        canvas.style.border = '4px dotted #333333';\n        return false;\n    }, false);\n    canvas.addEventListener('dragleave', function(e) {\n        prevent(e);\n        canvas.style.border = 'none';\n        return false;\n    });\n    // drag to play\n    canvas.addEventListener('drop', onDrop, false);\n    // for sample music data\n    canvas.addEventListener('click', sample, false);\n};\n\n/**\n * Sample music\n */\nconst sample = async () => {\n    // sample music one time\n    canvas.removeEventListener('click', sample, false);\n    // it takes precedence over VGM metadata\n    musicMeta = createGd3meta({\n        track_name: \"WebAssembly 👾 VGM Player\",\n        track_name_j: \"\",\n        game_name: \"\",\n        game_name_j: \"YM2612 sample VGM\",\n        track_author: \"@h1romas4\",\n        track_author_j: \"\"\n    });\n    const response = await fetch('./vgm/ym2612.vgm');\n    const bytes = await response.arrayBuffer();\n    play(bytes, musicMeta);\n}\n\n/**\n * Event prevent\n *\n * @param {*} e\n */\nconst prevent = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n};\n\n/**\n * Drag and Drop\n *\n * @param {*} ev\n * @returns false (prevent event)\n */\nconst onDrop = (ev) => {\n    prevent(ev);\n    // sample music one time\n    canvas.removeEventListener('click', sample, false);\n    // pause the drop event\n    canvas.removeEventListener('drop', onDrop, false);\n    canvas.style.border = 'none';\n    let filelist = {};\n    let files = ev.dataTransfer.files;\n    [].forEach.call(files, function(file) {\n        let reader = new FileReader();\n        reader.onload = function() {\n            filelist[file.name] = reader.result;\n            if(Object.keys(filelist).length >= files.length) {\n                // resume the drop event\n                canvas.addEventListener('drop', onDrop, false);\n                playlist = [];\n                Object.keys(filelist).sort().forEach(function(key) {\n                    playlist.push(filelist[key]);\n                });\n                totalPlaylistCount = playlist.length;\n                next();\n            }\n        };\n        reader.readAsArrayBuffer(file);\n    });\n    return false;\n};\n\n/**\n * Play next playlist\n */\nconst next = function() {\n    if(playlist.length <= 0) return;\n    play(playlist.shift());\n}\n\n/**\n * Play VGM\n *\n * @param {*} vgmfile\n * @param {*} altMeta\n */\nconst play = function(vgmfile, altMeta) {\n    // Worklet exchange callbacks\n    const start = () => {\n        player.create(vgmfile, (gd3) => {\n            if(altMeta == null) {\n                musicMeta = createGd3meta(gd3);\n            }\n            if(animId != null) {\n                window.cancelAnimationFrame(animId);\n                animId = null;\n            }\n            draw();\n            player.play(next);\n        });\n    };\n    // iOS only sounds AudioWorklet that created by the click event.\n    // In the case of ScriptProcessorNode, I had to create an AudioContext here.\n    if(!player.ready()) {\n        // for Chromium\n        // \"The AudioContext was not allowed to start.\n        //  It must be resumed (or created) after a user gesture on the page.\"\n        audioContext.resume();\n        // create audionode and gain\n        // wait 100ms for Chromium stunby\n        player.init(() => { setTimeout(start, 100) });\n    } else {\n        start();\n    }\n};\n\n/**\n * Create GD3 meta\n *\n * @param {*} meta\n * @returns\n */\nconst createGd3meta = function(meta) {\n    meta.game_track_name = [meta.game_name, meta.track_name].filter(str => str != \"\").join(\" | \");\n    meta.game_track_name_j = [meta.game_name_j, meta.track_name_j].filter(str => str != \"\").join(\" / \");\n    meta.track_author_full = [meta.track_author, meta.track_author_j].filter(str => str != \"\").join(\" - \");\n    canvasContext.font = FONT_MAIN_STYLE;\n    meta.game_track_name_left = (CANVAS_WIDTH - canvasContext.measureText(meta.game_track_name).width) / 2;\n    meta.game_track_name_j_left = (CANVAS_WIDTH - canvasContext.measureText(meta.game_track_name_j).width) / 2;\n    meta.track_author_full_left = (CANVAS_WIDTH - canvasContext.measureText(meta.track_author_full).width) / 2;\n    return meta;\n};\n\n/**\n * Draw\n */\nconst draw = function() {\n    animId = window.requestAnimationFrame(draw);\n    canvasContext.fillStyle = 'rgb(0, 0, 0)';\n    canvasContext.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);\n\n    let audioAnalyserBuffer = player.getByteFrequencyData();\n    let audioAnalyserBufferLength = player.getAnalyserBufferLength();\n\n    canvasContext.lineWidth = 1;\n    canvasContext.beginPath();\n    canvasContext.strokeStyle = COLOR_MD_RED;\n\n    let width = 4;\n    let step =  Math.round(audioAnalyserBufferLength / (CANVAS_WIDTH / width));\n    canvasContext.setLineDash([2, 1]);\n    canvasContext.lineWidth = width ;\n    for(var i = 0; i < audioAnalyserBufferLength; i += step) {\n        canvasContext.beginPath();\n        canvasContext.moveTo(i + 2, CANVAS_HEIGHT);\n        canvasContext.lineTo(i + 2, CANVAS_HEIGHT - (audioAnalyserBuffer[i] * 1.5));\n        canvasContext.stroke();\n    }\n    canvasContext.stroke();\n\n    canvasContext.font = \"12px monospace\";\n    canvasContext.fillStyle = COLOR_MD_GREEN;\n    if(totalPlaylistCount >= 1) {\n        fillTextCenterd(\"Track \" + (totalPlaylistCount - playlist.length) + \" / \" + totalPlaylistCount, CANVAS_HEIGHT / 2 - 96);\n    }\n    canvasContext.font = FONT_MAIN_STYLE;\n    canvasContext.fillText(musicMeta.game_track_name, musicMeta.game_track_name_left, CANVAS_HEIGHT / 2 - 64);\n    canvasContext.fillText(musicMeta.game_track_name_j, musicMeta.game_track_name_j_left, CANVAS_HEIGHT / 2 - 32);\n    canvasContext.fillText(musicMeta.track_author_full, musicMeta.track_author_full_left, CANVAS_HEIGHT / 2);\n    printStatus();\n}\n\n/**\n * Print status\n */\nconst printStatus = function() {\n    if(samplingRate == 44100) return;\n\n    const status = \" HD:\" + samplingRate + \" \";\n    canvasContext.font = '16px sans-serif';\n    const measure = canvasContext.measureText(status);\n    canvasContext.fillStyle = COLOR_MD_GREEN;\n    canvasContext.fillRect(CANVAS_WIDTH - measure.width, 0, CANVAS_WIDTH, 18);\n    canvasContext.fillStyle = 'rgb(0, 0, 0)';\n    canvasContext.fillText(status, CANVAS_WIDTH - measure.width, 16);\n}\n\n/**\n * Fill text center\n *\n * @param {*} str\n * @param {*} height\n */\nconst fillTextCenterd = function(str, height) {\n    let left = (CANVAS_WIDTH - canvasContext.measureText(str).width) / 2;\n    canvasContext.fillText(str, left, height);\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('iUJgi') + require('./helpers/bundle-manifest').resolve(\"bktC1\");"],"names":["$8b4d1930797b255e$export$6503ec6e8aabbaf","$8b4d1930797b255e$export$f7ad0328861e2f03","$8b4d1930797b255e$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","WgmController","constructor","module","samplingRate","loopMaxCount","feedOutSecond","this","feedOutRemain","Math","floor","context","worklet","gain","analyser","analyserBuffer","analyserBufferLength","async","audioWorklet","addModule","$parcel$interopDefault","$hWdwC","init","callback","AudioWorkletNode","numberOfInputs","numberOfOutputs","outputChannelCount","processorOptions","chunkSize","port","onmessage","event","dispatch","send","message","createGain","connect","destination","createAnalyser","frequencyBinCount","Uint8Array","getByteTimeDomainData","ready","create","vgmdata","play","getByteFrequencyData","getAnalyserBufferLength","feedout","now","currentTime","setValueAtTime","linearRampToValueAtTime","data","postMessage","exports","getBundleURL","resolve","$f29cd6c67ea13581$export$bdfd709ae4826697","$f29cd6c67ea13581$var$bundleURL","$f29cd6c67ea13581$var$getBaseURL","url","replace","value","err","matches","stack","match","$f29cd6c67ea13581$var$getBundleURL","$076a5d405d1fd9b2$var$player","$076a5d405d1fd9b2$var$audioContext","$076a5d405d1fd9b2$var$totalPlaylistCount","$076a5d405d1fd9b2$var$musicMeta","$076a5d405d1fd9b2$var$canvas","$076a5d405d1fd9b2$var$canvasContext","$076a5d405d1fd9b2$var$playlist","$076a5d405d1fd9b2$var$samplingRate","$076a5d405d1fd9b2$var$animId","document","getElementById","setAttribute","window","devicePixelRatio","screen","width","style","heigth","getContext","$e85978439c5a6efa$exports","location","hash","sample","parseInt","fetch","URL","arrayBuffer","$544ZB","AudioContext","webkitAudioContext","sampleRate","prepare","$076a5d405d1fd9b2$var$start","fillStyle","fillRect","font","$076a5d405d1fd9b2$var$fillTextCenterd","$076a5d405d1fd9b2$var$CANVAS_HEIGHT","$076a5d405d1fd9b2$var$printStatus","addEventListener","e","$076a5d405d1fd9b2$var$prevent","border","$076a5d405d1fd9b2$var$onDrop","$076a5d405d1fd9b2$var$sample","removeEventListener","$076a5d405d1fd9b2$var$createGd3meta","track_name","track_name_j","game_name","game_name_j","track_author","track_author_j","response","bytes","$076a5d405d1fd9b2$var$play","preventDefault","stopPropagation","ev","filelist","files","dataTransfer","forEach","call","file","reader","FileReader","onload","name","result","sort","key","push","$076a5d405d1fd9b2$var$next","readAsArrayBuffer","shift","vgmfile","altMeta","start","gd3","cancelAnimationFrame","$076a5d405d1fd9b2$var$draw","resume","setTimeout","meta","game_track_name","filter","str","join","game_track_name_j","track_author_full","game_track_name_left","measureText","game_track_name_j_left","track_author_full_left","requestAnimationFrame","audioAnalyserBuffer","audioAnalyserBufferLength","lineWidth","beginPath","strokeStyle","step","round","setLineDash","moveTo","lineTo","stroke","fillText","status","measure","height","left"],"version":3,"file":"index.fa78ce22.js.map"}