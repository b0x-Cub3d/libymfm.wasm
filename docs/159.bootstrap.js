"use strict";(self.webpackChunkwasm_vgm_player=self.webpackChunkwasm_vgm_player||[]).push([[159],{159:(e,t,n)=>{n.r(t);var r,a,o,i,l,u,c,f,_=n(182),s=n(674),d=4096,m=44100,g=768,y=576,h="#00a040",w="16px sans-serif",p=null,v=0,k=[],b=null,x=null,A=null;(c=document.getElementById("screen")).setAttribute("width",g),c.setAttribute("height",y),(window.devicePixelRatio?window.devicePixelRatio:1)>1&&window.screen.width<g&&(c.style.width="320px",c.style.heigth="240px"),f=c.getContext("2d"),fetch("./vgm/ym2612.vgm").then((function(e){return e.arrayBuffer()})).then((function(e){P(e)})).then((function(){c.addEventListener("click",L,!1),c.addEventListener("dragover",(function(e){return E(e),c.style.border="4px dotted #333333",!1}),!1),c.addEventListener("dragleave",(function(e){return E(e),c.style.border="none",!1})),c.addEventListener("drop",M,!1),r=1,a=D({track_name:"WebAssembly ðŸ‘¾ VGM Player",track_name_j:"",game_name:"",game_name_j:"YM2612 sample VGM",track_author:"@h1romas4",track_author_j:""}),b=new(window.AudioContext||window.webkitAudioContext)({sampleRate:m}),b=null,j()}));var T=function(e,t){var n=(g-f.measureText(e).width)/2;f.fillText(e,n,t)},j=function(){f.fillStyle="rgb(0, 0, 0)",f.fillRect(0,0,g,y),f.font="20px sans-serif",f.fillStyle=h,T("WebAssembly ðŸ‘¾ VGM Player",160),f.font="16px sans-serif",T("YM2151 | YM2203 | YM2149 | YM2413 | YM2612 | SN76489(MD) | PWM(32x)",224),f.font="20px sans-serif",T("ðŸŽµ DRAG AND DROP VGM(vgm/vgz) HEAR",256),T("OR CLICK(TAP) TO PLAY SAMPLE VGM",320)},E=function(e){e.preventDefault(),e.stopPropagation()},M=function e(t){E(t),c.removeEventListener("drop",e,!1),c.style.border="none";var n={},a=t.dataTransfer.files;return[].forEach.call(a,(function(t){var o=new FileReader;o.onload=function(){n[t.name]=o.result,Object.keys(n).length>=a.length&&(c.addEventListener("drop",e,!1),k=[],Object.keys(n).sort().forEach((function(e){k.push(n[e])})),r=k.length,C())},o.readAsArrayBuffer(t)})),!1},C=function e(){k.length<=0||(P(k.shift())?L():e())},D=function(e){return e.game_track_name=[e.game_name,e.track_name].filter((function(e){return""!=e})).join(" | "),e.game_track_name_j=[e.game_name_j,e.track_name_j].filter((function(e){return""!=e})).join(" / "),e.track_author_full=[e.track_author,e.track_author_j].filter((function(e){return""!=e})).join(" - "),f.font=w,e.game_track_name_left=(g-f.measureText(e.game_track_name).width)/2,e.game_track_name_j_left=(g-f.measureText(e.game_track_name_j).width)/2,e.track_author_full_left=(g-f.measureText(e.track_author_full).width)/2,e},P=function(e){return null!=p&&p.free(),p=new _.n9(m,d,e.byteLength),new Uint8Array(s.memory.buffer,p.get_seq_data_ref(),e.byteLength).set(new Uint8Array(e)),p.init()?(a=D(JSON.parse(p.get_seq_gd3())),!0):(p.free(),!1)},q=function(){null!=i&&i.disconnect(),null!=o&&o.disconnect(),null!=x&&x.disconnect(),i=null,x=null,o=null},L=function e(){c.removeEventListener("click",e,!1),q(),null==b&&(b=new(window.AudioContext||window.webkitAudioContext)({sampleRate:m})),x=b.createScriptProcessor(d,2,2),v=0;var t=!1;x.onaudioprocess=function(e){if(t)return q(),void C();var n;try{n=p.play()}catch(e){alert("ymfm:\n\nAn unexpected error has occurred. System has stoped. Please reload brwoser.\n\n".concat(e)),t=!0}e.outputBuffer.getChannelData(0).set(new Float32Array(s.memory.buffer,p.get_sampling_l_ref(),d)),e.outputBuffer.getChannelData(1).set(new Float32Array(s.memory.buffer,p.get_sampling_r_ref(),d)),n>=2&&(0==v&&n>2?t=!0:(0==v&&(o.gain.setValueAtTime(1,b.currentTime),o.gain.linearRampToValueAtTime(0,b.currentTime+2)),++v>21.533203125&&(t=!0)))},o=b.createGain(),x.connect(o),o.connect(b.destination),o.gain.setValueAtTime(1,b.currentTime),i=b.createAnalyser(),u=i.frequencyBinCount,l=new Uint8Array(u),i.getByteTimeDomainData(l),o.connect(i),null!=A&&(window.cancelAnimationFrame(A),A=null),R()},R=function e(){if(A=window.requestAnimationFrame(e),f.fillStyle="rgb(0, 0, 0)",f.fillRect(0,0,g,y),null!=i){i.getByteFrequencyData(l),f.lineWidth=1,f.beginPath(),f.strokeStyle="#e60012";var t=Math.round(u/192);f.setLineDash([2,1]),f.lineWidth=4;for(var n=0;n<u;n+=t)f.beginPath(),f.moveTo(n+2,y),f.lineTo(n+2,y-1.5*l[n]),f.stroke();f.stroke()}f.font="12px monospace",f.fillStyle=h,r>=1&&T("Track "+(r-k.length)+" / "+r,192),f.font=w,f.fillText(a.game_track_name,a.game_track_name_left,224),f.fillText(a.game_track_name_j,a.game_track_name_j_left,256),f.fillText(a.track_author_full,a.track_author_full_left,288)}},913:(e,t,n)=>{n.d(t,{Cf:()=>r,UX:()=>a,yU:()=>o});var r=function(e,t,n,r){console.log("fd_seek: ".concat(e,", ").concat(t,", ").concat(n,", ").concat(r))},a=function(e,t,n,r){console.log("fd_write: ".concat(e,", ").concat(t,", ").concat(n,", ").concat(r))},o=function(e){console.log("fd_close: ".concat(e))}},182:(e,t,n)=>{n.d(t,{n9:()=>h,z1:()=>w,h9:()=>p,Dz:()=>v,kF:()=>k,ug:()=>b,Or:()=>x});var r=n(674);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=n.hmd(e);var o=new Array(32).fill(void 0);function i(e){return o[e]}o.push(void 0,null,!0,!1);var l=o.length;var u=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});u.decode();var c=null;function f(){return null!==c&&c.buffer===r.memory.buffer||(c=new Uint8Array(r.memory.buffer)),c}function _(e,t){return u.decode(f().subarray(e,e+t))}var s=null;function d(){return null!==s&&s.buffer===r.memory.buffer||(s=new Int32Array(r.memory.buffer)),s}var m=0,g=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8"),y="function"==typeof g.encodeInto?function(e,t){return g.encodeInto(e,t)}:function(e,t){var n=g.encode(e);return t.set(n),{read:e.length,written:n.length}},h=function(){function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=r.wgmplay_from(t,n,a);return e.__wrap(o)}var t,n,o;return t=e,o=[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}}],(n=[{key:"__destroy_into_raw",value:function(){var e=this.ptr;return this.ptr=0,e}},{key:"free",value:function(){var e=this.__destroy_into_raw();r.__wbg_wgmplay_free(e)}},{key:"get_seq_data_ref",value:function(){return r.wgmplay_get_seq_data_ref(this.ptr)}},{key:"get_sampling_l_ref",value:function(){return r.wgmplay_get_sampling_l_ref(this.ptr)}},{key:"get_sampling_r_ref",value:function(){return r.wgmplay_get_sampling_r_ref(this.ptr)}},{key:"get_seq_header",value:function(){try{var e=r.__wbindgen_add_to_stack_pointer(-16);r.wgmplay_get_seq_header(e,this.ptr);var t=d()[e/4+0],n=d()[e/4+1];return _(t,n)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,n)}}},{key:"get_seq_gd3",value:function(){try{var e=r.__wbindgen_add_to_stack_pointer(-16);r.wgmplay_get_seq_gd3(e,this.ptr);var t=d()[e/4+0],n=d()[e/4+1];return _(t,n)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,n)}}},{key:"init",value:function(){return 0!==r.wgmplay_init(this.ptr)}},{key:"play",value:function(){return r.wgmplay_play(this.ptr)>>>0}}])&&a(t.prototype,n),o&&a(t,o),e}();function w(e,t){console.log(_(e,t))}function p(){return function(e){l===o.length&&o.push(o.length+1);var t=l;return l=o[t],o[t]=e,t}(new Error)}function v(e,t){var n=function(e,t,n){if(void 0===n){var r=g.encode(e),a=t(r.length);return f().subarray(a,a+r.length).set(r),m=r.length,a}for(var o=e.length,i=t(o),l=f(),u=0;u<o;u++){var c=e.charCodeAt(u);if(c>127)break;l[i+u]=c}if(u!==o){0!==u&&(e=e.slice(u)),i=n(i,o,o=u+3*e.length);var _=f().subarray(i+u,i+o);u+=y(e,_).written}return m=u,i}(i(t).stack,r.__wbindgen_malloc,r.__wbindgen_realloc),a=m;d()[e/4+1]=a,d()[e/4+0]=n}function k(e,t){try{console.error(_(e,t))}finally{r.__wbindgen_free(e,t)}}function b(e){var t;i(t=e),function(e){e<36||(o[e]=l,l=e)}(t)}function x(e,t){throw new Error(_(e,t))}},674:(e,t,n)=>{var r=n.w[e.id];e.exports=r,n(182),n(913),r[""]()}}]);