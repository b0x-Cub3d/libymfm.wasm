"use strict";(self.webpackChunkwasm_vgm_player=self.webpackChunkwasm_vgm_player||[]).push([[269],{269:(e,n,t)=>{t.r(n);var r,a,o,i,l,c,u,f,_=t(944),s=t(629),d=2048,g=44100,m=768,y=576,h="#00a040",p="#e60012",w="16px sans-serif",v=null,k=0,b=[],x=null,A=null,T=null;(u=document.getElementById("screen")).setAttribute("width",m),u.setAttribute("height",y),(window.devicePixelRatio?window.devicePixelRatio:1)>1&&window.screen.width<m&&(u.style.width="320px",u.style.heigth="240px"),f=u.getContext("2d"),fetch("./vgm/ym2612.vgm").then((function(e){return e.arrayBuffer()})).then((function(e){q(e)})).then((function(){u.addEventListener("click",R,!1),u.addEventListener("dragover",(function(e){return M(e),u.style.border="4px dotted #333333",!1}),!1),u.addEventListener("dragleave",(function(e){return M(e),u.style.border="none",!1})),u.addEventListener("drop",C,!1),r=1,a=D({track_name:"WebAssembly ðŸ‘¾ VGM Player",track_name_j:"",game_name:"",game_name_j:"YM2612 sample VGM",track_author:"@h1romas4",track_author_j:""}),x=new(window.AudioContext||window.webkitAudioContext)({sampleRate:g}),x=null,j()}));var E=function(e,n){var t=(m-f.measureText(e).width)/2;f.fillText(e,t,n)},j=function(){f.fillStyle="rgb(0, 0, 0)",f.fillRect(0,0,m,y),f.font="bold 28px sans-serif",f.fillStyle=p,E("WebAssembly ðŸŽ® VGM Player",160),f.fillStyle=h,f.font="15px sans-serif",E("YM2151 | YM2203 | YM2149 | YM2413 | YM2612 | SN76489(MD) | PWM(32x) | SEGAPCM",224),f.font="20px sans-serif",E("ðŸŽµ DRAG AND DROP VGM(vgm/vgz) HEAR",256),E("OR CLICK(TAP) TO PLAY SAMPLE VGM",320)},M=function(e){e.preventDefault(),e.stopPropagation()},C=function e(n){M(n),u.removeEventListener("drop",e,!1),u.style.border="none";var t={},a=n.dataTransfer.files;return[].forEach.call(a,(function(n){var o=new FileReader;o.onload=function(){t[n.name]=o.result,Object.keys(t).length>=a.length&&(u.addEventListener("drop",e,!1),b=[],Object.keys(t).sort().forEach((function(e){b.push(t[e])})),r=b.length,P())},o.readAsArrayBuffer(n)})),!1},P=function e(){b.length<=0||(q(b.shift())?R():e())},D=function(e){return e.game_track_name=[e.game_name,e.track_name].filter((function(e){return""!=e})).join(" | "),e.game_track_name_j=[e.game_name_j,e.track_name_j].filter((function(e){return""!=e})).join(" / "),e.track_author_full=[e.track_author,e.track_author_j].filter((function(e){return""!=e})).join(" - "),f.font=w,e.game_track_name_left=(m-f.measureText(e.game_track_name).width)/2,e.game_track_name_j_left=(m-f.measureText(e.game_track_name_j).width)/2,e.track_author_full_left=(m-f.measureText(e.track_author_full).width)/2,e},q=function(e){return null!=v&&v.free(),v=new s.n9(g,d,e.byteLength),new Uint8Array(_.memory.buffer,v.get_seq_data_ref(),e.byteLength).set(new Uint8Array(e)),v.init()?(a=D(JSON.parse(v.get_seq_gd3())),!0):(v.free(),!1)},L=function(){null!=i&&i.disconnect(),null!=o&&o.disconnect(),null!=A&&A.disconnect(),i=null,A=null,o=null},R=function e(){u.removeEventListener("click",e,!1),L(),null==x&&(x=new(window.AudioContext||window.webkitAudioContext)({sampleRate:g})),A=x.createScriptProcessor(d,2,2),k=0;var n=!1;A.onaudioprocess=function(e){if(n)return L(),void P();var t;try{t=v.play()}catch(e){alert("ymfm:\n\nAn unexpected error has occurred. System has stoped. Please reload brwoser.\n\n".concat(e)),n=!0}e.outputBuffer.getChannelData(0).set(new Float32Array(_.memory.buffer,v.get_sampling_l_ref(),d)),e.outputBuffer.getChannelData(1).set(new Float32Array(_.memory.buffer,v.get_sampling_r_ref(),d)),t>=2&&(0==k&&t>2?n=!0:(0==k&&(o.gain.setValueAtTime(1,x.currentTime),o.gain.linearRampToValueAtTime(0,x.currentTime+2)),++k>43.06640625&&(n=!0)))},o=x.createGain(),A.connect(o),o.connect(x.destination),o.gain.setValueAtTime(1,x.currentTime),i=x.createAnalyser(),c=i.frequencyBinCount,l=new Uint8Array(c),i.getByteTimeDomainData(l),o.connect(i),null!=T&&(window.cancelAnimationFrame(T),T=null),S()},S=function e(){if(T=window.requestAnimationFrame(e),f.fillStyle="rgb(0, 0, 0)",f.fillRect(0,0,m,y),null!=i){i.getByteFrequencyData(l),f.lineWidth=1,f.beginPath(),f.strokeStyle=p;var n=Math.round(c/192);f.setLineDash([2,1]),f.lineWidth=4;for(var t=0;t<c;t+=n)f.beginPath(),f.moveTo(t+2,y),f.lineTo(t+2,y-1.5*l[t]),f.stroke();f.stroke()}f.font="12px monospace",f.fillStyle=h,r>=1&&E("Track "+(r-b.length)+" / "+r,192),f.font=w,f.fillText(a.game_track_name,a.game_track_name_left,224),f.fillText(a.game_track_name_j,a.game_track_name_j_left,256),f.fillText(a.track_author_full,a.track_author_full_left,288)}},913:(e,n,t)=>{t.d(n,{Cf:()=>r,UX:()=>a,yU:()=>o,Vn:()=>i,lO:()=>l,NM:()=>c,H4:()=>u});var r=function(e,n,t,r){console.log("fd_seek: ".concat(e,", ").concat(n,", ").concat(t,", ").concat(r))},a=function(e,n,t,r){console.log("fd_write: ".concat(e,", ").concat(n,", ").concat(t,", ").concat(r))},o=function(e){console.log("fd_close: ".concat(e))},i=function(e,n){console.log("environ_sizes_get: ".concat(e,", ").concat(n))},l=function(e){console.log("proc_exit: ".concat(e))},c=function(e,n){console.log("environ_get: ".concat(e,", ").concat(n))},u=function(e,n){return console.log("random_get: ".concat(e,", ").concat(n)),0}},629:(e,n,t)=>{t.d(n,{n9:()=>h,h9:()=>p,Dz:()=>w,kF:()=>v,ug:()=>k,Or:()=>b});var r=t(944);function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=t.hmd(e);var o=new Array(32).fill(void 0);function i(e){return o[e]}o.push(void 0,null,!0,!1);var l=o.length;var c=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});c.decode();var u=null;function f(){return null!==u&&u.buffer===r.memory.buffer||(u=new Uint8Array(r.memory.buffer)),u}function _(e,n){return c.decode(f().subarray(e,e+n))}var s=null;function d(){return null!==s&&s.buffer===r.memory.buffer||(s=new Int32Array(r.memory.buffer)),s}var g=0,m=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8"),y="function"==typeof m.encodeInto?function(e,n){return m.encodeInto(e,n)}:function(e,n){var t=m.encode(e);return n.set(t),{read:e.length,written:t.length}},h=function(){function e(n,t,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var o=r.wgmplay_from(n,t,a);return e.__wrap(o)}var n,t,o;return n=e,o=[{key:"__wrap",value:function(n){var t=Object.create(e.prototype);return t.ptr=n,t}}],(t=[{key:"__destroy_into_raw",value:function(){var e=this.ptr;return this.ptr=0,e}},{key:"free",value:function(){var e=this.__destroy_into_raw();r.__wbg_wgmplay_free(e)}},{key:"get_seq_data_ref",value:function(){return r.wgmplay_get_seq_data_ref(this.ptr)}},{key:"get_sampling_l_ref",value:function(){return r.wgmplay_get_sampling_l_ref(this.ptr)}},{key:"get_sampling_r_ref",value:function(){return r.wgmplay_get_sampling_r_ref(this.ptr)}},{key:"get_seq_header",value:function(){try{var e=r.__wbindgen_add_to_stack_pointer(-16);r.wgmplay_get_seq_header(e,this.ptr);var n=d()[e/4+0],t=d()[e/4+1];return _(n,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(n,t)}}},{key:"get_seq_gd3",value:function(){try{var e=r.__wbindgen_add_to_stack_pointer(-16);r.wgmplay_get_seq_gd3(e,this.ptr);var n=d()[e/4+0],t=d()[e/4+1];return _(n,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(n,t)}}},{key:"init",value:function(){return 0!==r.wgmplay_init(this.ptr)}},{key:"play",value:function(){return r.wgmplay_play(this.ptr)>>>0}}])&&a(n.prototype,t),o&&a(n,o),e}();function p(){return function(e){l===o.length&&o.push(o.length+1);var n=l;return l=o[n],o[n]=e,n}(new Error)}function w(e,n){var t=function(e,n,t){if(void 0===t){var r=m.encode(e),a=n(r.length);return f().subarray(a,a+r.length).set(r),g=r.length,a}for(var o=e.length,i=n(o),l=f(),c=0;c<o;c++){var u=e.charCodeAt(c);if(u>127)break;l[i+c]=u}if(c!==o){0!==c&&(e=e.slice(c)),i=t(i,o,o=c+3*e.length);var _=f().subarray(i+c,i+o);c+=y(e,_).written}return g=c,i}(i(n).stack,r.__wbindgen_malloc,r.__wbindgen_realloc),a=g;d()[e/4+1]=a,d()[e/4+0]=t}function v(e,n){try{console.error(_(e,n))}finally{r.__wbindgen_free(e,n)}}function k(e){var n;i(n=e),function(e){e<36||(o[e]=l,l=e)}(n)}function b(e,n){throw new Error(_(e,n))}},944:(e,n,t)=>{var r=t.w[e.id];e.exports=r,t(913),t(629),r[""]()}}]);