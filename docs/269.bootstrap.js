"use strict";(self.webpackChunkwasm_vgm_player=self.webpackChunkwasm_vgm_player||[]).push([[269],{269:(e,t,n)=>{n.r(t);var r,a,o,l,i,c,u,f,_,s,d,g,m,h,y,p,w,v=n(861),k=n(757),b=n.n(k),x=n(944),A=n(629),T=768,E=576,M="#00a040",j="#e60012",D="16px sans-serif",P=null,S=[],C=44100,q=null,L=null,R=null,O=null;(y=document.getElementById("screen")).setAttribute("width",T),y.setAttribute("height",E),(window.devicePixelRatio?window.devicePixelRatio:1)>1&&window.screen.width<T&&(y.style.width="320px",y.style.heigth="240px"),p=y.getContext("2d"),function(){if(""!=location.hash){var e=location.hash.match(/^#s=(\d+)/);null!=e&&((C=parseInt(e[1]))!=C||44100!=C&&48e3!=C&&88200!=C&&96e3!=C)&&(C=44100)}}(),w=(q=new(window.AudioContext||window.webkitAudioContext)({sampleRate:C})).createScriptProcessor(0,2,2),o=w?w.bufferSize:2048,q=null,l=2*C/o,(0,v.Z)(b().mark((function e(){var t,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("./vgm/ym2612.vgm");case 2:return t=e.sent,e.next=5,t.arrayBuffer();case 5:n=e.sent,U(n),y.addEventListener("click",z,!1),y.addEventListener("dragover",(function(e){return I(e),y.style.border="4px dotted #333333",!1}),!1),y.addEventListener("dragleave",(function(e){return I(e),y.style.border="none",!1})),y.addEventListener("drop",V,!1),r=1,a=Y({track_name:"WebAssembly ðŸ‘¾ VGM Player",track_name_j:"",game_name:"",game_name_j:"YM2612 sample VGM",track_author:"@h1romas4",track_author_j:""}),F();case 14:case"end":return e.stop()}}),e)})))();var B=function(e,t){var n=(T-p.measureText(e).width)/2;p.fillText(e,n,t)},F=function(){p.fillStyle="rgb(0, 0, 0)",p.fillRect(0,0,T,E),p.font="bold 28px sans-serif",p.fillStyle=j,B("WebAssembly ðŸŽ® VGM Player",160),p.fillStyle=M,p.font="15px sans-serif",B("YM2151 | YM2203 | YM2149 | YM2413 | YM2612 | SN76489(MD) | PWM(32x) | SEGAPCM",224),p.font="20px sans-serif",B("ðŸŽµ DRAG AND DROP VGM(vgm/vgz) HEAR",256),B("OR CLICK(TAP) TO PLAY SAMPLE VGM",320),H()},I=function(e){e.preventDefault(),e.stopPropagation()},V=function e(t){I(t),y.removeEventListener("drop",e,!1),y.style.border="none";var n={},a=t.dataTransfer.files;return[].forEach.call(a,(function(t){var o=new FileReader;o.onload=function(){n[t.name]=o.result,Object.keys(n).length>=a.length&&(y.addEventListener("drop",e,!1),S=[],Object.keys(n).sort().forEach((function(e){S.push(n[e])})),r=S.length,G())},o.readAsArrayBuffer(t)})),!1},G=function e(){S.length<=0||(U(S.shift())?z():e())},Y=function(e){return e.game_track_name=[e.game_name,e.track_name].filter((function(e){return""!=e})).join(" | "),e.game_track_name_j=[e.game_name_j,e.track_name_j].filter((function(e){return""!=e})).join(" / "),e.track_author_full=[e.track_author,e.track_author_j].filter((function(e){return""!=e})).join(" - "),p.font=D,e.game_track_name_left=(T-p.measureText(e.game_track_name).width)/2,e.game_track_name_j_left=(T-p.measureText(e.game_track_name_j).width)/2,e.track_author_full_left=(T-p.measureText(e.track_author_full).width)/2,e},U=function(e){if(null!=P&&P.free(),P=new A.n9(C,o,e.byteLength),new Uint8Array(x.memory.buffer,P.get_seq_data_ref(),e.byteLength).set(new Uint8Array(e)),!P.init())return P.free(),!1;a=Y(JSON.parse(P.get_seq_gd3())),_=[],s=[],g=0,m=0,h=null,null!=R&&(clearInterval(R),R=null);var t=!1,n=0;return d=!1,R=setInterval((function(){var e;t&&clearInterval(R);try{if(_.length<10&&!t){e=P.play();var r=new Float32Array(o),a=new Float32Array(o);r.set(new Float32Array(x.memory.buffer,P.get_sampling_l_ref(),o)),a.set(new Float32Array(x.memory.buffer,P.get_sampling_r_ref(),o)),_.push(r),s.push(a),_.length>=10&&(d=!0),e>=2&&(0==n&&e>2?t=!0:(0==n&&(h=m),++n>l&&(t=!0))),m++}}catch(e){alert("ymfm:\n\nAn unexpected error has occurred. System has stoped. Please reload brwoser.\n\n".concat(e)),t=!0}}),o/C/2*1e3),!0},W=function(){null!=c&&c.disconnect(),null!=i&&i.disconnect(),null!=L&&L.disconnect(),c=null,L=null,i=null},z=function e(){y.removeEventListener("click",e,!1),W(),null==q&&(q=new(window.AudioContext||window.webkitAudioContext)({sampleRate:C})),(L=q.createScriptProcessor(o,2,2)).onaudioprocess=function(e){1==d&&_.length>0?(e.outputBuffer.getChannelData(0).set(_[0]),e.outputBuffer.getChannelData(1).set(s[0]),_.shift(),s.shift(),g==h&&(i.gain.setValueAtTime(1,q.currentTime),i.gain.linearRampToValueAtTime(0,q.currentTime+2)),g++):1==d&&0==_.length&&(W(),G())},i=q.createGain(),L.connect(i),i.connect(q.destination),i.gain.setValueAtTime(1,q.currentTime),c=q.createAnalyser(),f=c.frequencyBinCount,u=new Uint8Array(f),c.getByteTimeDomainData(u),i.connect(c),null!=O&&(window.cancelAnimationFrame(O),O=null),N()},N=function e(){if(O=window.requestAnimationFrame(e),p.fillStyle="rgb(0, 0, 0)",p.fillRect(0,0,T,E),null!=c){c.getByteFrequencyData(u),p.lineWidth=1,p.beginPath(),p.strokeStyle=j;var t=Math.round(f/192);p.setLineDash([2,1]),p.lineWidth=4;for(var n=0;n<f;n+=t)p.beginPath(),p.moveTo(n+2,E),p.lineTo(n+2,E-1.5*u[n]),p.stroke();p.stroke()}p.font="12px monospace",p.fillStyle=M,r>=1&&B("Track "+(r-S.length)+" / "+r,192),p.font=D,p.fillText(a.game_track_name,a.game_track_name_left,224),p.fillText(a.game_track_name_j,a.game_track_name_j_left,256),p.fillText(a.track_author_full,a.track_author_full_left,288),H()},H=function(){if(44100!=C){var e=" HD:"+C+" ";p.font="16px sans-serif";var t=p.measureText(e);p.fillStyle=M,p.fillRect(T-t.width,0,T,18),p.fillStyle="rgb(0, 0, 0)",p.fillText(e,T-t.width,16)}}},913:(e,t,n)=>{n.d(t,{Cf:()=>r,UX:()=>a,yU:()=>o,Vn:()=>l,lO:()=>i,NM:()=>c,H4:()=>u});var r=function(e,t,n,r){console.log("fd_seek: ".concat(e,", ").concat(t,", ").concat(n,", ").concat(r))},a=function(e,t,n,r){console.log("fd_write: ".concat(e,", ").concat(t,", ").concat(n,", ").concat(r))},o=function(e){console.log("fd_close: ".concat(e))},l=function(e,t){console.log("environ_sizes_get: ".concat(e,", ").concat(t))},i=function(e){console.log("proc_exit: ".concat(e))},c=function(e,t){console.log("environ_get: ".concat(e,", ").concat(t))},u=function(e,t){return console.log("random_get: ".concat(e,", ").concat(t)),0}},629:(e,t,n)=>{n.d(t,{n9:()=>p,h9:()=>w,Dz:()=>v,kF:()=>k,ug:()=>b,Or:()=>x});var r=n(671),a=n(144),o=n(944);e=n.hmd(e);var l=new Array(32).fill(void 0);function i(e){return l[e]}l.push(void 0,null,!0,!1);var c=l.length;var u=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});u.decode();var f=null;function _(){return null!==f&&f.buffer===o.memory.buffer||(f=new Uint8Array(o.memory.buffer)),f}function s(e,t){return u.decode(_().subarray(e,e+t))}var d=null;function g(){return null!==d&&d.buffer===o.memory.buffer||(d=new Int32Array(o.memory.buffer)),d}var m=0,h=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8"),y="function"==typeof h.encodeInto?function(e,t){return h.encodeInto(e,t)}:function(e,t){var n=h.encode(e);return t.set(n),{read:e.length,written:n.length}},p=function(){function e(t,n,a){(0,r.Z)(this,e);var l=o.wgmplay_from(t,n,a);return e.__wrap(l)}return(0,a.Z)(e,[{key:"__destroy_into_raw",value:function(){var e=this.ptr;return this.ptr=0,e}},{key:"free",value:function(){var e=this.__destroy_into_raw();o.__wbg_wgmplay_free(e)}},{key:"get_seq_data_ref",value:function(){return o.wgmplay_get_seq_data_ref(this.ptr)}},{key:"get_sampling_l_ref",value:function(){return o.wgmplay_get_sampling_l_ref(this.ptr)}},{key:"get_sampling_r_ref",value:function(){return o.wgmplay_get_sampling_r_ref(this.ptr)}},{key:"get_seq_header",value:function(){try{var e=o.__wbindgen_add_to_stack_pointer(-16);o.wgmplay_get_seq_header(e,this.ptr);var t=g()[e/4+0],n=g()[e/4+1];return s(t,n)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_free(t,n)}}},{key:"get_seq_gd3",value:function(){try{var e=o.__wbindgen_add_to_stack_pointer(-16);o.wgmplay_get_seq_gd3(e,this.ptr);var t=g()[e/4+0],n=g()[e/4+1];return s(t,n)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_free(t,n)}}},{key:"init",value:function(){return 0!==o.wgmplay_init(this.ptr)}},{key:"play",value:function(){return o.wgmplay_play(this.ptr)>>>0}}],[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}}]),e}();function w(){return function(e){c===l.length&&l.push(l.length+1);var t=c;return c=l[t],l[t]=e,t}(new Error)}function v(e,t){var n=function(e,t,n){if(void 0===n){var r=h.encode(e),a=t(r.length);return _().subarray(a,a+r.length).set(r),m=r.length,a}for(var o=e.length,l=t(o),i=_(),c=0;c<o;c++){var u=e.charCodeAt(c);if(u>127)break;i[l+c]=u}if(c!==o){0!==c&&(e=e.slice(c)),l=n(l,o,o=c+3*e.length);var f=_().subarray(l+c,l+o);c+=y(e,f).written}return m=c,l}(i(t).stack,o.__wbindgen_malloc,o.__wbindgen_realloc),r=m;g()[e/4+1]=r,g()[e/4+0]=n}function k(e,t){try{console.error(s(e,t))}finally{o.__wbindgen_free(e,t)}}function b(e){var t;i(t=e),function(e){e<36||(l[e]=c,c=e)}(t)}function x(e,t){throw new Error(s(e,t))}},944:(e,t,n)=>{var r=n.w[e.id];e.exports=r,n(913),n(629),r[""]()}}]);