function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},a={},i=r.parcelRequire546c;null==i&&((i=function(e){if(e in n)return n[e].exports;if(e in a){var t=a[e];delete a[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){a[e]=t},r.parcelRequire546c=i),i.register("27Lyk",(function(t,r){var n,a;e(t.exports,"register",(()=>n),(e=>n=e)),e(t.exports,"resolve",(()=>a),(e=>a=e));var i={};n=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)i[t[r]]=e[t[r]]},a=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),i.register("4wLdb",(function(r,n){e(r.exports,"WgmController",(()=>l),(e=>l=e));var a=i("2gP1w"),s=i("bHfhW");class l{constructor(e,t,r){this.module=e,this.worklet=null,this.worker=null,this.callback=null,this.sharedRingL=[],this.sharedRingR=[],this.sharedStatus=null,this.samplingRate=t,this.loopMaxCount=r,this.chunkSize=a.AUDIO_WORKLET_SAMPLING_CHUNK*a.BUFFERING_CHUNK_COUNT,this.feedOutRemain=1,this.feedOutSecond=Math.floor(this.chunkSize*this.feedOutRemain/t),this.context=null,this.gain=null,this.analyser=null,this.analyserBuffer=null,this.analyserBufferLength=null}async prepare(e,r){this.context=e;try{for(let e=0;e<a.BUFFER_RING_COUNT;e++)this.sharedRingL[e]=new SharedArrayBuffer(4*this.chunkSize),this.sharedRingR[e]=new SharedArrayBuffer(4*this.chunkSize);this.sharedStatus=new SharedArrayBuffer(1024)}catch(e){return!1}return this.worker=new Worker(i("eP3uQ")),this.worker.onmessage=e=>this.dispatch(e),this.sendWorker({message:"compile",shared:{ringL:this.sharedRingL,ringR:this.sharedRingR,status:this.sharedStatus}},(async()=>{await this.context.audioWorklet.addModule(t(s)),r()})),!0}init(){this.worklet=new AudioWorkletNode(this.context,"wgm-worklet-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],processorOptions:{ringL:this.sharedRingL,ringR:this.sharedRingR,status:this.sharedStatus,chunkSteps:a.BUFFERING_CHUNK_COUNT}}),this.worklet.port.onmessage=e=>this.dispatch(e),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.worklet.connect(this.gain),this.analyser=this.context.createAnalyser(),this.analyserBufferLength=this.analyser.frequencyBinCount,this.analyserBuffer=new Uint8Array(this.analyserBufferLength),this.analyser.getByteTimeDomainData(this.analyserBuffer),this.gain.connect(this.analyser)}ready(){return null!=this.worklet}create(e,t,r){this.sendWorklet({message:"stop"},(()=>{this.sendWorker({message:"create",wgmdata:e,type:t,options:{samplingRate:this.samplingRate,chunkSize:this.chunkSize,loopMaxCount:this.loopMaxCount,feedOutRemain:this.feedOutRemain}},r)}))}play(e){this.gain.gain.setValueAtTime(1,this.context.currentTime),this.sendWorker({message:"start"}),this.sendWorklet({message:"play"},e)}getByteFrequencyData(){return this.analyser.getByteFrequencyData(this.analyserBuffer),this.analyserBuffer}getAnalyserBufferLength(){return this.analyserBufferLength}feedout(){const e=this.context.currentTime;this.gain.gain.setValueAtTime(1,e),this.gain.gain.linearRampToValueAtTime(0,e+this.feedOutSecond)}async dispatch(e){switch(e.data.message){case"callback":null!=this.callback&&await this.callback(e.data.data);break;case"feedout":this.feedout()}}sendWorklet(e,t){this.callback=null!=t?t:null,this.worklet.port.postMessage(e)}sendWorker(e,t){this.callback=null!=t?t:null,this.worker.postMessage(e)}}})),i.register("2gP1w",(function(t,r){e(t.exports,"AUDIO_WORKLET_SAMPLING_CHUNK",(()=>n)),e(t.exports,"BUFFERING_CHUNK_COUNT",(()=>a)),e(t.exports,"BUFFER_RING_COUNT",(()=>i));const n=128,a=768,i=4})),i.register("bHfhW",(function(e,t){e.exports=new URL(i("27Lyk").resolve("frDq4"),import.meta.url).toString()})),i.register("eP3uQ",(function(e,t){var r=i("7ryUf");let n=new URL(i("27Lyk").resolve("eDdCm"),import.meta.url);e.exports=r(n.toString(),n.origin,!0)})),i.register("7ryUf",(function(e,t){e.exports=function(e,t,r){if(t===self.location.origin)return e;var n=r?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))}})),i("27Lyk").register(JSON.parse('{"g3LtT":"index.075f4c9b.js","frDq4":"wgm_worklet_processor.4d3ce39b.js","eDdCm":"wgm_worker.9daa7062.js","fpIuB":"libymfm_bg.b44913f8.wasm"}'));var s=i("4wLdb");let l,o,f,u,c,h=null,d=!1,g=[],m=44100,p=null;!function(){u=document.getElementById("screen"),u.setAttribute("width",768),u.setAttribute("height",576),(window.devicePixelRatio?window.devicePixelRatio:1)>1&&window.screen.width<768&&(u.style.width="320px",u.style.heigth="240px"),c=u.getContext("2d"),c.font="20px sans-serif",c.fillStyle="#00a040";const e="Now Loading...";let t=(768-c.measureText(e).width)/2;c.fillText(e,t,256)}();var y;y=new URL(i("27Lyk").resolve("fpIuB"),import.meta.url).toString(),async function(){if(""!=location.hash){const e=location.hash.match(/^#s=(\d+)/);null!=e&&(m=parseInt(e[1]),(m!=m||44100!=m&&48e3!=m&&88200!=m&&96e3!=m)&&(m=44100))}let e=await fetch(new URL(y));e=new Uint8Array(await e.arrayBuffer()),l=new(0,s.WgmController)(e,m,2),h=new(window.AudioContext||window.webkitAudioContext)({sampleRate:m}),await l.prepare(h,(()=>{_()}))||k()}();const _=()=>{w(),c.fillStyle="#00a040",c.font="14px sans-serif",B("YM2149 | YM2151 | YM2203 | YM2413 | YM2608 | YM2610(B) | YM2612 | YM3526 | Y8950 | YM3812 | YMF262 | YMF278B",176),B("SN76489(MD) | PWM(32X) | SEGAPCM | OKIM6258(X68K) | C140(C219) | OKIM6295",196),c.font="20px sans-serif",B("🎶 DRAG AND DROP VGM(vgm/vgz) || XGM(xgm/xgz) HEAR",256),c.font="15px sans-serif",B("or click to play sample music",320),A(),u.addEventListener("dragover",(function(e){return b(e),u.style.border="4px dotted #333333",!1}),!1),u.addEventListener("dragleave",(function(e){return b(e),u.style.border="4px solid #000",!1})),u.addEventListener("drop",R,!1),u.addEventListener("click",x,!1)},k=()=>{w(),B("System initialize error.",224),c.font="20px sans-serif",c.fillStyle="#00a040",B("Your browser does not support SharedArrayBuffer.",288),B("SharedArrayBuffer is supported by Firefox or Chromium systems.",320)},w=()=>{c.fillStyle="rgb(0, 0, 0)",c.fillRect(0,0,768,576),c.font="bold 28px sans-serif",c.fillStyle="#e60012",B("WebAssembly 🎮 VGM Player",128)},x=async()=>{u.removeEventListener("click",x,!1),f=L({track_name:"🤍 Thank you for trying this player",track_name_j:"",game_name:"",game_name_j:"A synthesizer written in WebAssembly",track_author:"See the GitHub repository for more information",track_author_j:""});const e=await fetch("./vgm/ym2612.vgm"),t=await e.arrayBuffer();d=!0,v(t,"vgm",f)},b=function(e){e.preventDefault(),e.stopPropagation()},R=e=>{b(e),u.removeEventListener("click",x,!1),u.removeEventListener("drop",R,!1),u.style.border="4px solid #000";let t={},r=e.dataTransfer.files;return[].forEach.call(r,(function(e){let n=new FileReader;n.onload=function(){t[e.name]=n.result,Object.keys(t).length>=r.length&&(u.addEventListener("drop",R,!1),g=[],Object.keys(t).sort().forEach((function(e){g.push({filename:e,xgmdata:t[e]})})),o=g.length,d?S():(w(),c.font="28px sans-serif",c.fillStyle="#00a040",B("OK! CLICK or TAP to start playback!",480),c.arc(384,288,96,0*Math.PI/180,360*Math.PI/180,!1),c.fillStyle="#e60012",c.fill(),c.beginPath(),c.moveTo(344,238),c.lineTo(344,338),c.lineTo(444,288),c.closePath(),c.strokeStyle="#ffffff",c.stroke(),c.fillStyle="#ffffff",c.fill(),d=!0,u.addEventListener("click",S,!1)))},n.readAsArrayBuffer(e)})),!1},S=function(){if(u.removeEventListener("click",S,!1),g.length<=0)return;const e=g.shift();let t="vgm";/\.xg[m|z]$/.test(e.filename)&&(t="xgm"),v(e.xgmdata,t)},v=function(e,t,r){l.ready()||(h.resume(),l.init()),l.create(e,t,(e=>{null==r&&(f=L(e)),null!=p&&(window.cancelAnimationFrame(p),p=null),T(),l.play(S)}))},L=function(e){return e.game_track_name=[e.game_name,e.track_name].filter((e=>""!=e)).join(" | "),e.game_track_name_j=[e.game_name_j,e.track_name_j].filter((e=>""!=e)).join(" / "),e.track_author_full=[e.track_author,e.track_author_j].filter((e=>""!=e)).join(" - "),c.font="16px sans-serif",e.game_track_name_left=(768-c.measureText(e.game_track_name).width)/2,e.game_track_name_j_left=(768-c.measureText(e.game_track_name_j).width)/2,e.track_author_full_left=(768-c.measureText(e.track_author_full).width)/2,e},T=function(){p=window.requestAnimationFrame(T),c.fillStyle="rgb(0, 0, 0)",c.fillRect(0,0,768,576);let e=l.getByteFrequencyData(),t=l.getAnalyserBufferLength();c.lineWidth=1,c.beginPath(),c.strokeStyle="#e60012";let r=Math.round(t/192);c.setLineDash([2,1]),c.lineWidth=4;for(var n=0;n<t;n+=r)c.beginPath(),c.moveTo(n+2,576),c.lineTo(n+2,576-1.5*e[n]),c.stroke();c.stroke(),c.font="12px monospace",c.fillStyle="#00a040",o>=1&&B("Track "+(o-g.length)+" / "+o,192),c.font="16px sans-serif",c.fillText(f.game_track_name,f.game_track_name_left,224),c.fillText(f.game_track_name_j,f.game_track_name_j_left,256),c.fillText(f.track_author_full,f.track_author_full_left,288),A()},A=function(){if(44100==m)return;const e=" HD:"+m+" ";c.font="16px sans-serif";const t=c.measureText(e);c.fillStyle="#00a040",c.fillRect(768-t.width,0,768,18),c.fillStyle="rgb(0, 0, 0)",c.fillText(e,768-t.width,16)},B=function(e,t){let r=(768-c.measureText(e).width)/2;c.fillText(e,r,t)};
//# sourceMappingURL=index.075f4c9b.js.map
