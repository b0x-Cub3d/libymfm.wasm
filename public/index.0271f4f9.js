function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},i={},a=r.parcelRequire546c;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in i){var t=i[e];delete i[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){i[e]=t},r.parcelRequire546c=a),a.register("bXuNP",(function(t,r){var n,i;e(t.exports,"register",(()=>n),(e=>n=e)),e(t.exports,"resolve",(()=>i),(e=>i=e));var a={};n=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)a[t[r]]=e[t[r]]},i=function(e){var t=a[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),a("bXuNP").register(JSON.parse('{"iUJgi":"index.0271f4f9.js","cHc5m":"wgm_worklet_processor.abebf595.js","cywbx":"wgm_worker.19aec03a.js","bktC1":"libymfm_bg.0593478c.wasm"}')),a.register("544ZB",(function(r,n){e(r.exports,"WgmController",(()=>o),(e=>o=e));var i=a("bdp79"),s=a("hWdwC");class o{constructor(e,t,r){this.module=e,this.worklet=null,this.worker=null,this.callback=null,this.sharedRingL=[],this.sharedRingR=[],this.sharedStatus=null,this.samplingRate=t,this.loopMaxCount=r,this.chunkSize=i.AUDIO_WORKLET_SAMPLING_CHUNK*i.BUFFERING_CHUNK_COUNT,this.feedOutRemain=1,this.feedOutSecond=Math.floor(this.chunkSize*this.feedOutRemain/t),this.context=null,this.gain=null,this.analyser=null,this.analyserBuffer=null,this.analyserBufferLength=null}async prepare(e,r){this.context=e;try{for(let e=0;e<i.BUFFER_RING_COUNT;e++)this.sharedRingL[e]=new SharedArrayBuffer(4*this.chunkSize),this.sharedRingR[e]=new SharedArrayBuffer(4*this.chunkSize);this.sharedStatus=new SharedArrayBuffer(1024)}catch(e){return!1}return this.worker=new Worker(a("5JiMz"),{type:"module"}),this.worker.onmessage=e=>this.dispatch(e),this.sendWorker({message:"compile",shared:{ringL:this.sharedRingL,ringR:this.sharedRingR,status:this.sharedStatus}},(async()=>{await this.context.audioWorklet.addModule(t(s)),r()})),!0}init(){this.worklet=new AudioWorkletNode(this.context,"wgm-worklet-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],processorOptions:{ringL:this.sharedRingL,ringR:this.sharedRingR,status:this.sharedStatus,chunkSteps:i.BUFFERING_CHUNK_COUNT}}),this.worklet.port.onmessage=e=>this.dispatch(e),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.worklet.connect(this.gain),this.analyser=this.context.createAnalyser(),this.analyserBufferLength=this.analyser.frequencyBinCount,this.analyserBuffer=new Uint8Array(this.analyserBufferLength),this.analyser.getByteTimeDomainData(this.analyserBuffer),this.gain.connect(this.analyser)}ready(){return null!=this.worklet}create(e,t,r){this.sendWorklet({message:"stop"},(()=>{this.sendWorker({message:"create",wgmdata:e,type:t,options:{samplingRate:this.samplingRate,chunkSize:this.chunkSize,loopMaxCount:this.loopMaxCount,feedOutRemain:this.feedOutRemain}},r)}))}play(e){this.gain.gain.setValueAtTime(1,this.context.currentTime),this.sendWorker({message:"start"}),this.sendWorklet({message:"play"},e)}getByteFrequencyData(){return this.analyser.getByteFrequencyData(this.analyserBuffer),this.analyserBuffer}getAnalyserBufferLength(){return this.analyserBufferLength}feedout(){const e=this.context.currentTime;this.gain.gain.setValueAtTime(1,e),this.gain.gain.linearRampToValueAtTime(0,e+this.feedOutSecond)}async dispatch(e){switch(e.data.message){case"callback":null!=this.callback&&await this.callback(e.data.data);break;case"feedout":this.feedout()}}sendWorklet(e,t){this.callback=null!=t?t:null,this.worklet.port.postMessage(e)}sendWorker(e,t){this.callback=null!=t?t:null,this.worker.postMessage(e)}}})),a.register("bdp79",(function(t,r){e(t.exports,"AUDIO_WORKLET_SAMPLING_CHUNK",(()=>n)),e(t.exports,"BUFFERING_CHUNK_COUNT",(()=>i)),e(t.exports,"BUFFER_RING_COUNT",(()=>a));const n=128,i=768,a=4})),a.register("hWdwC",(function(e,t){e.exports=a("kPq84").getBundleURL("iUJgi")+a("bXuNP").resolve("cHc5m")})),a.register("kPq84",(function(t,r){var n,i;e(t.exports,"getBundleURL",(()=>n),(e=>n=e)),e(t.exports,"getOrigin",(()=>i),(e=>i=e));var a={};function s(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}n=function(e){var t=a[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return s(e[2])}return"/"}(),a[e]=t),t},i=function(e){var t=(""+e).match(/(https?|file|ftp):\/\/[^/]+/);if(!t)throw new Error("Origin not found");return t[0]}})),a.register("5JiMz",(function(e,t){var r=a("hxJhJ"),n=a("kPq84");let i=n.getBundleURL("iUJgi")+a("bXuNP").resolve("cywbx");e.exports=r(i,n.getOrigin(i),!0)})),a.register("hxJhJ",(function(e,t){e.exports=function(e,t,r){if(t===self.location.origin)return e;var n=r?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))}}));var s=a("544ZB");let o,l,u,c,h,f=[],d=44100,g=null;!function(){c=document.getElementById("screen"),c.setAttribute("width",768),c.setAttribute("height",576),(window.devicePixelRatio?window.devicePixelRatio:1)>1&&window.screen.width<768&&(c.style.width="320px",c.style.heigth="240px"),h=c.getContext("2d"),h.font="20px sans-serif",h.fillStyle="#00a040";const e="Now Loading...";let t=(768-h.measureText(e).width)/2;h.fillText(e,t,256)}();var m;m=a("kPq84").getBundleURL("iUJgi")+a("bXuNP").resolve("bktC1"),async function(){if(""!=location.hash){const e=location.hash.match(/^#s=(\d+)/);null!=e&&(d=parseInt(e[1]),(d!=d||44100!=d&&48e3!=d&&88200!=d&&96e3!=d)&&(d=44100))}let e=await fetch(new URL(m));e=new Uint8Array(await e.arrayBuffer()),o=new s.WgmController(e,d,2),p()}();const p=()=>{y(),h.fillStyle="#00a040",h.font="15px sans-serif",A("YM2149 | YM2151 | YM2203 | YM2413 | YM2608 | YM2610(B) | YM2612 | YM3526 | Y8950",176),A("YM3812 | YMF262 | YMF278B | SN76489(MD) | PWM(32x) | SEGAPCM | OKIM6285(X68K)",196),h.font="20px sans-serif",A("🎶 DRAG AND DROP VGM(vgm/vgz) || XGM(xgm/xgz) HEAR",256),h.font="15px sans-serif",A("or click to play sample music",320),B(),c.addEventListener("dragover",(function(e){return w(e),c.style.border="4px dotted #333333",!1}),!1),c.addEventListener("dragleave",(function(e){return w(e),c.style.border="4px solid #000",!1})),c.addEventListener("drop",k,!1),c.addEventListener("click",_,!1)},y=()=>{h.fillStyle="rgb(0, 0, 0)",h.fillRect(0,0,768,576),h.font="bold 28px sans-serif",h.fillStyle="#e60012",A("WebAssembly 🎮 VGM Player",128)},_=async()=>{c.removeEventListener("click",_,!1),u=v({track_name:"🤍 Thank you for trying this player",track_name_j:"",game_name:"",game_name_j:"A synthesizer written in WebAssembly",track_author:"See the GitHub repository for more information",track_author_j:""});const e=await fetch("./vgm/ym2612.vgm"),t=await e.arrayBuffer();b(t,"vgm",u)},w=function(e){e.preventDefault(),e.stopPropagation()},k=e=>{w(e),c.removeEventListener("click",_,!1),c.removeEventListener("drop",k,!1),c.style.border="4px solid #000";let t={},r=e.dataTransfer.files;return[].forEach.call(r,(function(e){let n=new FileReader;n.onload=function(){t[e.name]=n.result,Object.keys(t).length>=r.length&&(c.addEventListener("drop",k,!1),f=[],Object.keys(t).sort().forEach((function(e){f.push({filename:e,xgmdata:t[e]})})),l=f.length,x())},n.readAsArrayBuffer(e)})),!1},x=function(){if(f.length<=0)return;const e=f.shift();let t="vgm";/\.xg[m|z]$/.test(e.filename)&&(t="xgm"),b(e.xgmdata,t)},b=function(e,t,r){if(o.ready())R(e,t,r);else{const n=new(window.AudioContext||window.webkitAudioContext)({sampleRate:d});o.prepare(n,(()=>{o.init(),R(e,t,r)}))||(y(),A("System initialize error.",224),h.font="20px sans-serif",h.fillStyle="#00a040",A("Your browser does not support SharedArrayBuffer.",288),A("SharedArrayBuffer is supported by Firefox or Chromium systems.",320))}},R=(e,t,r)=>{o.create(e,t,(e=>{null==r&&(u=v(e)),null!=g&&(window.cancelAnimationFrame(g),g=null),S(),o.play(x)}))},v=function(e){return e.game_track_name=[e.game_name,e.track_name].filter((e=>""!=e)).join(" | "),e.game_track_name_j=[e.game_name_j,e.track_name_j].filter((e=>""!=e)).join(" / "),e.track_author_full=[e.track_author,e.track_author_j].filter((e=>""!=e)).join(" - "),h.font="16px sans-serif",e.game_track_name_left=(768-h.measureText(e.game_track_name).width)/2,e.game_track_name_j_left=(768-h.measureText(e.game_track_name_j).width)/2,e.track_author_full_left=(768-h.measureText(e.track_author_full).width)/2,e},S=function(){g=window.requestAnimationFrame(S),h.fillStyle="rgb(0, 0, 0)",h.fillRect(0,0,768,576);let e=o.getByteFrequencyData(),t=o.getAnalyserBufferLength();h.lineWidth=1,h.beginPath(),h.strokeStyle="#e60012";let r=Math.round(t/192);h.setLineDash([2,1]),h.lineWidth=4;for(var n=0;n<t;n+=r)h.beginPath(),h.moveTo(n+2,576),h.lineTo(n+2,576-1.5*e[n]),h.stroke();h.stroke(),h.font="12px monospace",h.fillStyle="#00a040",l>=1&&A("Track "+(l-f.length)+" / "+l,192),h.font="16px sans-serif",h.fillText(u.game_track_name,u.game_track_name_left,224),h.fillText(u.game_track_name_j,u.game_track_name_j_left,256),h.fillText(u.track_author_full,u.track_author_full_left,288),B()},B=function(){if(44100==d)return;const e=" HD:"+d+" ";h.font="16px sans-serif";const t=h.measureText(e);h.fillStyle="#00a040",h.fillRect(768-t.width,0,768,18),h.fillStyle="rgb(0, 0, 0)",h.fillText(e,768-t.width,16)},A=function(e,t){let r=(768-h.measureText(e).width)/2;h.fillText(e,r,t)};
//# sourceMappingURL=index.0271f4f9.js.map
