let e,t,r,n,a;function i(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},l={},o={},f=s.parcelRequire546c;null==f&&((f=function(e){if(e in l)return l[e].exports;if(e in o){var t=o[e];delete o[e];var r={id:e,exports:{}};return l[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){o[e]=t},s.parcelRequire546c=f),f.register("27Lyk",function(e,t){"use strict";i(e.exports,"register",()=>r,e=>r=e),i(e.exports,"resolve",()=>n,e=>n=e);var r,n,a={};r=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)a[t[r]]=e[t[r]]},n=function(e){var t=a[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}}),f.register("4wLdb",function(e,t){i(e.exports,"WgmController",()=>a,e=>a=e);var r=f("2gP1w"),n=f("bHfhW");class a{constructor(e,t,n){this.module=e,this.worklet=null,this.worker=null,this.callback=null,this.sharedRingL=[],this.sharedRingR=[],this.sharedStatus=null,this.samplingRate=t,this.loopMaxCount=n,this.chunkSize=r.AUDIO_WORKLET_SAMPLING_CHUNK*r.BUFFERING_CHUNK_COUNT,this.feedOutRemain=1,this.feedOutSecond=Math.floor(this.chunkSize*this.feedOutRemain/t),this.context=null,this.gain=null,this.analyser=null,this.analyserBuffer=null,this.analyserBufferLength=null}async prepare(e,t){this.context=e;try{for(let e=0;e<r.BUFFER_RING_COUNT;e++)this.sharedRingL[e]=new SharedArrayBuffer(4*this.chunkSize),this.sharedRingR[e]=new SharedArrayBuffer(4*this.chunkSize);this.sharedStatus=new SharedArrayBuffer(1024)}catch(e){return!1}return this.worker=new Worker(f("eP3uQ")),this.worker.onmessage=e=>this.dispatch(e),this.sendWorker({message:"compile",shared:{ringL:this.sharedRingL,ringR:this.sharedRingR,status:this.sharedStatus}},async()=>{await this.context.audioWorklet.addModule(n&&n.__esModule?n.default:n),t()}),!0}init(){this.worklet=new AudioWorkletNode(this.context,"wgm-worklet-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],processorOptions:{ringL:this.sharedRingL,ringR:this.sharedRingR,status:this.sharedStatus,chunkSteps:r.BUFFERING_CHUNK_COUNT}}),this.worklet.port.onmessage=e=>this.dispatch(e),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.worklet.connect(this.gain),this.analyser=this.context.createAnalyser(),this.analyserBufferLength=this.analyser.frequencyBinCount,this.analyserBuffer=new Uint8Array(this.analyserBufferLength),this.analyser.getByteTimeDomainData(this.analyserBuffer),this.gain.connect(this.analyser)}ready(){return null!=this.worklet}create(e,t,r){this.sendWorklet({message:"stop"},()=>{this.sendWorker({message:"create",wgmdata:e,type:t,options:{samplingRate:this.samplingRate,chunkSize:this.chunkSize,loopMaxCount:this.loopMaxCount,feedOutRemain:this.feedOutRemain}},r)})}play(e){this.gain.gain.setValueAtTime(1,this.context.currentTime),this.sendWorker({message:"start"}),this.sendWorklet({message:"play"},e)}getByteFrequencyData(){return this.analyser.getByteFrequencyData(this.analyserBuffer),this.analyserBuffer}getAnalyserBufferLength(){return this.analyserBufferLength}feedout(){let e=this.context.currentTime;this.gain.gain.setValueAtTime(1,e),this.gain.gain.linearRampToValueAtTime(0,e+this.feedOutSecond)}async dispatch(e){switch(e.data.message){case"callback":null!=this.callback&&await this.callback(e.data.data);break;case"feedout":this.feedout()}}sendWorklet(e,t){null!=t?this.callback=t:this.callback=null,this.worklet.port.postMessage(e)}sendWorker(e,t){null!=t?this.callback=t:this.callback=null,this.worker.postMessage(e)}}}),f.register("2gP1w",function(e,t){i(e.exports,"AUDIO_WORKLET_SAMPLING_CHUNK",()=>r),i(e.exports,"BUFFERING_CHUNK_COUNT",()=>n),i(e.exports,"BUFFER_RING_COUNT",()=>a);let r=128,n=768,a=4}),f.register("bHfhW",function(e,t){e.exports=new URL(f("27Lyk").resolve("frDq4"),import.meta.url).toString()}),f.register("eP3uQ",function(e,t){var r=f("7ryUf");let n=new URL(f("27Lyk").resolve("eDdCm"),import.meta.url);e.exports=r(n.toString(),n.origin,!0)}),f.register("7ryUf",function(e,t){"use strict";e.exports=function(e,t,r){if(t===self.location.origin)return e;var n=r?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))}}),f("27Lyk").register(JSON.parse('{"g3LtT":"index.bdfdbb3e.js","frDq4":"wgm_worklet_processor.4d3ce39b.js","eDdCm":"wgm_worker.76908457.js","Sv3zf":"wgm_worker.2b5342f9.js","fpIuB":"libymfm_bg.496732f9.wasm"}'));var u=f("4wLdb");const h="#00a040",c="#e60012",d="16px sans-serif";let g=null,m=!1,p=[],y=44100,_=null;!function(){(n=document.getElementById("screen")).setAttribute("width",768),n.setAttribute("height",576),(window.devicePixelRatio?window.devicePixelRatio:1)>1&&window.screen.width<768&&(n.style.width="320px",n.style.heigth="240px"),(a=n.getContext("2d")).font="20px sans-serif",a.fillStyle=h;let e="Now Loading...",t=(768-a.measureText(e).width)/2;a.fillText(e,t,256)}();var k={};k=new URL(f("27Lyk").resolve("fpIuB"),import.meta.url).toString(),async function(){if(""!=location.hash){let e=location.hash.match(/^#s=(\d+)/);null==e||(y=parseInt(e[1]))==y&&(44100==y||48e3==y||88200==y||96e3==y)||(y=44100)}let t=await fetch(new URL(k));t=new Uint8Array(await t.arrayBuffer()),e=new u.WgmController(t,y,2),g=new(window.AudioContext||window.webkitAudioContext)({sampleRate:y}),await e.prepare(g,()=>{w()})||x()}();const w=()=>{b(),a.fillStyle=h,a.font="14px sans-serif",M("YM2149 | YM2151 | YM2203 | YM2413 | YM2608 | YM2610(B) | YM2612 | YM3526 | Y8950 | YM3812 | YMF262 | YMF278B",176),M("SN76489(MD) | PWM(32X) | SEGAPCM | OKIM6258(X68K) | C140(C219) | OKIM6295",196),a.font="20px sans-serif",M("\uD83C\uDFB6 DRAG AND DROP VGM(vgm/vgz) || XGM(xgm/xgz) HEAR",256),a.font="15px sans-serif",M("or click to play sample music",320),C(),n.addEventListener("dragover",function(e){return v(e),n.style.border="4px dotted #333333",!1},!1),n.addEventListener("dragleave",function(e){return v(e),n.style.border="4px solid #000",!1}),n.addEventListener("drop",L,!1),n.addEventListener("click",S,!1)},x=()=>{b(),M("System initialize error.",224),a.font="20px sans-serif",a.fillStyle=h,M("Your browser does not support SharedArrayBuffer.",288),M("SharedArrayBuffer is supported by Firefox or Chromium systems.",320)},b=()=>{a.fillStyle="rgb(0, 0, 0)",a.fillRect(0,0,768,576),a.font="bold 28px sans-serif",a.fillStyle=c,M("WebAssembly \uD83C\uDFAE VGM Player",128)},R=()=>{b(),a.font="28px sans-serif",a.fillStyle=h,M("OK! CLICK or TAP to start playback!",480),a.arc(384,288,96,0*Math.PI/180,360*Math.PI/180,!1),a.fillStyle=c,a.fill(),a.beginPath(),a.moveTo(344,238),a.lineTo(344,338),a.lineTo(444,288),a.closePath(),a.strokeStyle="#ffffff",a.stroke(),a.fillStyle="#ffffff",a.fill(),m=!0,n.addEventListener("click",A,!1)},S=async()=>{n.removeEventListener("click",S,!1),r=B({track_name:"\uD83E\uDD0D Thank you for trying this player",track_name_j:"",game_name:"",game_name_j:"A synthesizer written in WebAssembly",track_author:"See the GitHub repository for more information",track_author_j:""});let e=await fetch("./vgm/ym2612.vgm"),t=await e.arrayBuffer();m=!0,T(t,"vgm",r)},v=function(e){e.preventDefault(),e.stopPropagation()},L=e=>{v(e),n.removeEventListener("click",S,!1),n.removeEventListener("drop",L,!1),n.style.border="4px solid #000";let r={},a=e.dataTransfer.files;return[].forEach.call(a,function(e){let i=new FileReader;i.onload=function(){r[e.name]=i.result,Object.keys(r).length>=a.length&&(n.addEventListener("drop",L,!1),p=[],Object.keys(r).sort().forEach(function(e){p.push({filename:e,xgmdata:r[e]})}),t=p.length,m?A():R())},i.readAsArrayBuffer(e)}),!1},A=function(){if(n.removeEventListener("click",A,!1),p.length<=0)return;let e=p.shift(),t="vgm";/\.xg[m|z]$/.test(e.filename)&&(t="xgm"),T(e.xgmdata,t)},T=function(t,n,a){e.ready()||(g.resume(),e.init()),e.create(t,n,t=>{null==a&&(r=B(t)),null!=_&&(window.cancelAnimationFrame(_),_=null),O(),e.play(A)})},B=function(e){return e.game_track_name=[e.game_name,e.track_name].filter(e=>""!=e).join(" | "),e.game_track_name_j=[e.game_name_j,e.track_name_j].filter(e=>""!=e).join(" / "),e.track_author_full=[e.track_author,e.track_author_j].filter(e=>""!=e).join(" - "),a.font=d,e.game_track_name_left=(768-a.measureText(e.game_track_name).width)/2,e.game_track_name_j_left=(768-a.measureText(e.game_track_name_j).width)/2,e.track_author_full_left=(768-a.measureText(e.track_author_full).width)/2,e},O=function(){_=window.requestAnimationFrame(O),a.fillStyle="rgb(0, 0, 0)",a.fillRect(0,0,768,576);let n=e.getByteFrequencyData(),i=e.getAnalyserBufferLength();a.lineWidth=1,a.beginPath(),a.strokeStyle=c;let s=Math.round(i/192);a.setLineDash([2,1]),a.lineWidth=4;for(var l=0;l<i;l+=s)a.beginPath(),a.moveTo(l+2,576),a.lineTo(l+2,576-1.5*n[l]),a.stroke();a.stroke(),a.font="12px monospace",a.fillStyle=h,t>=1&&M("Track "+(t-p.length)+" / "+t,192),a.font=d,a.fillText(r.game_track_name,r.game_track_name_left,224),a.fillText(r.game_track_name_j,r.game_track_name_j_left,256),a.fillText(r.track_author_full,r.track_author_full_left,288),C()},C=function(){if(44100==y)return;let e=" HD:"+y+" ";a.font="16px sans-serif";let t=a.measureText(e);a.fillStyle=h,a.fillRect(768-t.width,0,768,18),a.fillStyle="rgb(0, 0, 0)",a.fillText(e,768-t.width,16)},M=function(e,t){let r=(768-a.measureText(e).width)/2;a.fillText(e,r,t)};
//# sourceMappingURL=index.bdfdbb3e.js.map
